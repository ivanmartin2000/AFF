<div class="producto-subasta">
  <h1>Mis productos en Subasta</h1>

  <div class="producto-card" *ngFor="let producto of productos">
    <h2>{{ producto.nombre }}</h2>
    <p>{{ producto.descripcion }}</p>
    <p><strong>Precio actual:</strong> ${{ producto.precio }}</p>
    
    <p *ngIf="timers[producto.idProducto]">
      <strong>Tiempo restante:</strong>
      {{ timers[producto.idProducto]?.horas ?? 0 }}h :
      {{ timers[producto.idProducto]?.minutos ?? 0 }}m :
      {{ timers[producto.idProducto]?.segundos ?? 0 }}s
    </p>
    

    <p *ngIf="timers[producto.idProducto].horas === 0 &&
              timers[producto.idProducto].minutos === 0 &&
              timers[producto.idProducto].segundos === 0" class="expired">
      ‚è≥ Subasta Finalizada
    </p>

    <img *ngIf="producto.rutaImagen && producto.nombreImagen"
         [src]="producto.rutaImagen + producto.nombreImagen"
         alt="{{ producto.nombre }}" />

    <button (click)="openBidModal(producto)"
            [disabled]="timers[producto.idProducto].horas === 0 &&
                       timers[producto.idProducto].minutos === 0 &&
                       timers[producto.idProducto].segundos === 0">
      Pujar
    </button>
  </div>
</div>

<!-- Modal para realizar puja -->
<div class="modal-overlay" *ngIf="bidModalVisible" (click)="closeBidModal()"></div>
<div class="bid-modal" *ngIf="bidModalVisible">
  <h3>Realizar Puja para {{ selectedProducto?.nombre }}</h3>
  <form [formGroup]="bidForm" (ngSubmit)="submitBid()">
    <div class="form-group">
      <label>Monto de Puja:</label>
      <input type="number" formControlName="monto" placeholder="Ingresa tu oferta">
    </div>
    <div *ngIf="errorMessage" class="error-message">
      {{ errorMessage }}
    </div>
    <div class="modal-buttons">
      <button type="submit">Enviar Puja</button>
      <button type="button" (click)="closeBidModal()">Cancelar</button>
    </div>
  </form>
</div>
